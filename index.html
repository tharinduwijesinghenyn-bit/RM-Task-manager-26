<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manager Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
    --bg:#0b0f1a;
    --card:#141b2d;
    --rm:#4fd1c5;
    --fg:#63b3ed;
    --warn:#f6ad55;
    --danger:#fc8181;
    --text:#e2e8f0;
    --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
    margin:0;
    font-family:Inter,system-ui,Arial;
    background:var(--bg);
    color:var(--text);
}

/* HEADER */
header{
    padding:18px 26px;
    background:linear-gradient(90deg,#1a202c,#0b0f1a);
    display:flex;
    justify-content:space-between;
    align-items:center;
}
header h1{margin:0;font-size:22px}
#clock{color:var(--muted);font-size:14px}

/* SECTION */
.section{
    margin:26px;
}
.section-title{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:16px;
}
.badge{
    padding:6px 14px;
    border-radius:999px;
    font-weight:700;
    font-size:13px;
}
.badge.rm{background:rgba(79,209,197,.15);color:var(--rm)}
.badge.fg{background:rgba(99,179,237,.15);color:var(--fg)}
.section-title h2{
    margin:0;
    font-size:20px;
}

/* GRID */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}

/* CARDS */
.card{
    background:var(--card);
    border-radius:18px;
    padding:20px;
    box-shadow:0 18px 40px rgba(0,0,0,.35);
}
.card h3{
    margin:0 0 10px;
    font-size:14px;
    color:var(--muted);
}
.big{
    font-size:34px;
    font-weight:700;
}
.rm-text{color:var(--rm)}
.fg-text{color:var(--fg)}
.orange{color:var(--warn)}
.red{color:var(--danger)}
.wide{grid-column:1/-1}

/* TABLE */
table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}
th,td{
    padding:10px;
    border-bottom:1px solid rgba(255,255,255,.08);
}
th{color:var(--muted);text-align:left}

/* CHAT */
.chat-btn{
    position:fixed;
    bottom:22px;
    right:22px;
    width:60px;height:60px;
    border-radius:50%;
    background:linear-gradient(135deg,var(--rm),var(--fg));
    border:none;
    font-size:26px;
    cursor:pointer;
}
.chat{
    position:fixed;
    bottom:100px;
    right:22px;
    width:340px;
    background:#0f1526;
    border-radius:18px;
    display:none;
    flex-direction:column;
    box-shadow:0 20px 40px rgba(0,0,0,.45);
}
.chat header{
    padding:14px 18px;
    font-size:15px;
    color:var(--rm);
}
.chat-body{
    padding:14px;
    height:260px;
    overflow:auto;
    font-size:14px;
}
.chat-input{display:flex}
.chat-input input{
    flex:1;
    padding:12px;
    background:#0b0f1a;
    border:none;
    color:#fff;
}
.chat-input button{
    padding:12px 16px;
    background:var(--rm);
    border:none;
    font-weight:bold;
}
.msg-user{color:var(--warn)}
.msg-ai{color:var(--rm)}

footer{
    text-align:center;
    padding:16px;
    color:var(--muted);
    font-size:13px;
}
</style>
</head>

<body>

<header>
    <h1>ðŸ“Š Manager Command Center</h1>
    <div id="clock"></div>
</header>

<!-- ================= RM DEPARTMENT ================= -->
<section class="section">
    <div class="section-title">
        <span class="badge rm">RM Department</span>
        <h2>Raw Material Operations</h2>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>Employees</h3>
            <div class="big rm-text" id="rmEmp">0</div>
        </div>
        <div class="card">
            <h3>Running Tasks</h3>
            <div class="big orange" id="rmRun">0</div>
        </div>
        <div class="card">
            <h3>Completed</h3>
            <div class="big rm-text" id="rmDone">0</div>
        </div>
        <div class="card">
            <h3>Idle Staff</h3>
            <div class="big red" id="rmIdle">0</div>
        </div>

        <div class="card">
            <h3>Task Status</h3>
            <canvas id="rmTaskChart"></canvas>
        </div>
        <div class="card">
            <h3>11 Hour Performance</h3>
            <canvas id="rmHourChart"></canvas>
        </div>

        <div class="card wide">
            <h3>RM Live Tasks</h3>
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Task</th>
                        <th>Status</th>
                        <th>Minutes</th>
                    </tr>
                </thead>
                <tbody id="rmTable"></tbody>
            </table>
        </div>
    </div>
</section>

<!-- ================= FG DEPARTMENT ================= -->
<section class="section">
    <div class="section-title">
        <span class="badge fg">FG Department</span>
        <h2>Finished Goods Operations</h2>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>Employees</h3>
            <div class="big fg-text" id="fgEmp">0</div>
        </div>
        <div class="card">
            <h3>Running Tasks</h3>
            <div class="big orange" id="fgRun">0</div>
        </div>
        <div class="card">
            <h3>Completed</h3>
            <div class="big fg-text" id="fgDone">0</div>
        </div>
        <div class="card">
            <h3>Idle Staff</h3>
            <div class="big red" id="fgIdle">0</div>
        </div>

        <div class="card">
            <h3>Task Status</h3>
            <canvas id="fgTaskChart"></canvas>
        </div>
        <div class="card">
            <h3>11 Hour Performance</h3>
            <canvas id="fgHourChart"></canvas>
        </div>

        <div class="card wide">
            <h3>FG Live Tasks</h3>
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Task</th>
                        <th>Status</th>
                        <th>Minutes</th>
                    </tr>
                </thead>
                <tbody id="fgTable"></tbody>
            </table>
        </div>
    </div>
</section>

<footer>
    Read-only Manager Dashboard â€¢ RM & FG Department View
</footer>

<button class="chat-btn" onclick="toggleChat()">ðŸ’¬</button>

<div class="chat" id="chat">
    <header>Manager Assistant</header>
    <div class="chat-body" id="chatBody">
        <div class="msg-ai">
            Ask:<br>
            â€¢ RM idle staff<br>
            â€¢ FG top performer<br>
            â€¢ Over 8 hours<br>
            â€¢ Summary
        </div>
    </div>
    <div class="chat-input">
        <input id="chatInput" placeholder="Ask hereâ€¦">
        <button onclick="ask()">Send</button>
    </div>
</div>

<script>
let rmTaskChart,rmHourChart,fgTaskChart,fgHourChart;
let people=[];

function updateClock(){
    clock.innerText=new Date().toLocaleString();
}
setInterval(updateClock,1000);updateClock();

function toggleChat(){
    chat.style.display = chat.style.display==="flex"?"none":"flex";
}
function msg(cls,text){
    chatBody.innerHTML+=`<div class="${cls}">${text}</div>`;
    chatBody.scrollTop=chatBody.scrollHeight;
}

function ask(){
    const q=chatInput.value.toLowerCase();
    msg("msg-user","You: "+chatInput.value);
    chatInput.value="";
    if(q.includes("rm")){
        msg("msg-ai","RM employees: "+people.filter(p=>p.dept==="RM").map(p=>p.name).join(", "));
    }else if(q.includes("fg")){
        msg("msg-ai","FG employees: "+people.filter(p=>p.dept==="FG").map(p=>p.name).join(", "));
    }else{
        msg("msg-ai","Ask about RM or FG departments.");
    }
}

function load(){
    const data=JSON.parse(localStorage.getItem("rm-task-manager-state")||"{}");

    let rm={emp:0,run:0,done:0,idle:0,perf:[]};
    let fg={emp:0,run:0,done:0,idle:0,perf:[]};

    rmTable.innerHTML="";
    fgTable.innerHTML="";
    people=[];

    (data.shifts||[]).forEach(s=>{
        (s.members||[]).forEach(m=>{
            const dept=(m.department||"RM").toUpperCase();
            let t=0,r=false;
            (m.tasks||[]).forEach(ts=>{
                t+=ts.elapsedSeconds||0;
                if(ts.status==="running"){r=true}
                if(ts.status==="completed"){
                    dept==="RM"?rm.done++:fg.done++;
                }
                const row=`<tr>
                    <td>${m.name}</td>
                    <td>${ts.name}</td>
                    <td>${ts.status}</td>
                    <td>${Math.floor((ts.elapsedSeconds||0)/60)}</td>
                </tr>`;
                dept==="RM"?rmTable.innerHTML+=row:fgTable.innerHTML+=row;
            });

            const target=dept==="RM"?rm:fg;
            target.emp++;
            if(r) target.run++; else target.idle++;
            target.perf.push(t);
            people.push({name:m.name,dept:dept,time:t});
        });
    });

    rmEmp.innerText=rm.emp;
    rmRun.innerText=rm.run;
    rmDone.innerText=rm.done;
    rmIdle.innerText=rm.idle;

    fgEmp.innerText=fg.emp;
    fgRun.innerText=fg.run;
    fgDone.innerText=fg.done;
    fgIdle.innerText=fg.idle;

    drawTask(rmTaskChart,"rmTaskChart",rm.run,rm.done,rm.idle,["#f6ad55","#4fd1c5","#fc8181"]);
    drawTask(fgTaskChart,"fgTaskChart",fg.run,fg.done,fg.idle,["#f6ad55","#63b3ed","#fc8181"]);

    drawHour(rmHourChart,"rmHourChart",rm.perf,"#4fd1c5");
    drawHour(fgHourChart,"fgHourChart",fg.perf,"#63b3ed");
}

function drawTask(chart,id,run,done,idle,colors){
    if(chart)chart.destroy();
    chart=new Chart(document.getElementById(id),{
        type:"doughnut",
        data:{labels:["Running","Completed","Idle"],
        datasets:[{data:[run,done,idle],backgroundColor:colors}]},
        options:{plugins:{legend:{labels:{color:"#94a3b8"}}}}
    });
    return chart;
}

function drawHour(chart,id,arr,color){
    let b=[0,0,0,0,0];
    arr.forEach(sec=>{
        const h=sec/3600;
        if(h<=2)b[0]++; else if(h<=4)b[1]++;
        else if(h<=6)b[2]++; else if(h<=8)b[3]++; else b[4]++;
    });
    if(chart)chart.destroy();
    chart=new Chart(document.getElementById(id),{
        type:"bar",
        data:{
            labels:["0â€“2","2â€“4","4â€“6","6â€“8","8â€“11"],
            datasets:[{data:b,backgroundColor:color,borderRadius:10}]
        },
        options:{
            plugins:{legend:{display:false}},
            scales:{x:{ticks:{color:"#94a3b8"}},y:{beginAtZero:true,ticks:{color:"#94a3b8"}}}
        }
    });
    return chart;
}

load();
setInterval(load,10000);
</script>

</body>
</html>